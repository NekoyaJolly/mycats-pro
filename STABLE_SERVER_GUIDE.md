# å®‰å®šç‰ˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã€é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å®‰å®šã—ã¦èµ·å‹•ãƒ»ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
é€šå¸¸ã® `pnpm run dev` ã§ã¯ Ctrl+C ã§ç°¡å˜ã«åœæ­¢ã—ã¦ã—ã¾ã†å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸãŒã€ã“ã‚Œã‚‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®‰å®šã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’ç¨¼åƒã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰

### 1. ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ï¼ˆå®‰å®šç‰ˆï¼‰

```bash
pnpm run dev:stable
# ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ
./scripts/start-dev-stable.sh
```

**æ©Ÿèƒ½:**
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆport 3004ï¼‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆport 3000ï¼‰ã‚’**ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰**ã§èµ·å‹•
- å„ãƒ—ãƒ­ã‚»ã‚¹ã®PIDã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ï¼ˆ`backend.pid`, `frontend.pid`ï¼‰
- ãƒ­ã‚°ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ï¼ˆ`backend.out`, `backend.log`, `frontend.out`, `frontend.log`ï¼‰
- Ctrl+C ã®å½±éŸ¿ã‚’å—ã‘ãªã„
- èµ·å‹•æ™‚ã«ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ

**å‡ºåŠ›ä¾‹:**
```
ğŸš€ Starting MyCats Development Environment (Stable Mode)
========================================================

ğŸ§¹ Cleaning up ports...
ğŸ”§ Starting backend server...
   Backend PID: 82584
   Logs: backend.out / backend.log

â³ Waiting for backend to start...
âœ… Backend is ready!

ğŸ¨ Starting frontend server...
   Frontend PID: 83222
   Logs: frontend.out / frontend.log

âœ… Development servers are running!

ğŸ“ URLs:
   Backend:  http://localhost:3004
   Frontend: http://localhost:3000
   API Docs: http://localhost:3004/api/docs
   Health:   http://localhost:3004/health
```

### 2. ã‚µãƒ¼ãƒãƒ¼ã®åœæ­¢

```bash
pnpm run dev:stop
# ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ
./scripts/stop-dev.sh
```

**æ©Ÿèƒ½:**
- PIDãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
- ãƒãƒ¼ãƒˆã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚‚å®Ÿè¡Œ

### 3. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```bash
pnpm run dev:health
# ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ
./scripts/health-check.sh
```

**æ©Ÿèƒ½:**
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ç¨¼åƒçŠ¶æ³ã‚’ç¢ºèª
- ãƒ—ãƒ­ã‚»ã‚¹IDã®ç¢ºèª
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ

**å‡ºåŠ›ä¾‹:**
```
ğŸ¥ MyCats Development Servers Health Check
==========================================

Backend Server:
Checking Backend...
  âœ… Process running (PID: 82584)
  âœ… Service responding at http://localhost:3004/health

Frontend Server:
Checking Frontend...
  âœ… Process running (PID: 83222)
  âœ… Service responding at http://localhost:3000

==========================================
âœ… All services are healthy
```

### 4. ãƒ­ã‚°ã®ç¢ºèª

ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ­ã‚°ã‚’ç¢ºèª:

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°ï¼ˆé€šå¸¸å‡ºåŠ›ï¼‰
tail -f backend.out

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°ï¼ˆã‚¨ãƒ©ãƒ¼å‡ºåŠ›ï¼‰
tail -f backend.log

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°ï¼ˆé€šå¸¸å‡ºåŠ›ï¼‰
tail -f frontend.out

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°ï¼ˆã‚¨ãƒ©ãƒ¼å‡ºåŠ›ï¼‰
tail -f frontend.log
```

ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¾Œã®è¡Œã‚’è¡¨ç¤º:

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®æœ€æ–°ãƒ­ã‚°
tail -20 backend.out

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æœ€æ–°ãƒ­ã‚°
tail -20 frontend.out
```

## ä½¿ç”¨ã‚·ãƒŠãƒªã‚ª

### ã‚·ãƒŠãƒªã‚ª 1: é€šå¸¸ã®é–‹ç™ºä½œæ¥­

```bash
# 1. ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
pnpm run dev:stable

# 2. é–‹ç™ºä½œæ¥­ã‚’é€²ã‚ã‚‹ï¼ˆã‚µãƒ¼ãƒãƒ¼ã¯åœæ­¢ã—ãªã„ï¼‰

# 3. å¿…è¦ã«å¿œã˜ã¦ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
pnpm run dev:health

# 4. ä½œæ¥­çµ‚äº†æ™‚ã«ã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢
pnpm run dev:stop
```

### ã‚·ãƒŠãƒªã‚ª 2: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```bash
# 1. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã§å•é¡Œã‚’ç¢ºèª
pnpm run dev:health

# 2. ãƒ­ã‚°ã‚’ç¢ºèª
tail -50 backend.log

# 3. ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•
pnpm run dev:stop
pnpm run dev:stable
```

### ã‚·ãƒŠãƒªã‚ª 3: é•·æ™‚é–“ã®å®Ÿè¡Œ

```bash
# 1. ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
pnpm run dev:stable

# 2. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‰ã˜ã¦ã‚‚OKï¼ˆãƒ—ãƒ­ã‚»ã‚¹ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ç¶™ç¶šï¼‰

# 3. å¾Œã§åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰çŠ¶æ…‹ã‚’ç¢ºèª
pnpm run dev:health
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãªã„

```bash
# 1. è¨ºæ–­ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ
pnpm run diagnose

# 2. ãƒãƒ¼ãƒˆãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
lsof -i :3004 -i :3000

# 3. å¤ã„ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
pnpm run dev:stop
pnpm run predev

# 4. å†èµ·å‹•
pnpm run dev:stable
```

### ãƒ­ã‚°ãŒè¦‹ã¤ã‹ã‚‰ãªã„

ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®å ´æ‰€ã«ä¿å­˜ã•ã‚Œã¾ã™:
- `/Users/nekoya/mycats/backend.out`
- `/Users/nekoya/mycats/backend.log`
- `/Users/nekoya/mycats/frontend.out`
- `/Users/nekoya/mycats/frontend.log`

### ãƒ—ãƒ­ã‚»ã‚¹ãŒæ®‹ã£ã¦ã„ã‚‹

```bash
# PIDãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
cat backend.pid
cat frontend.pid

# æ‰‹å‹•ã§ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
kill $(cat backend.pid) $(cat frontend.pid)

# ã¾ãŸã¯å¼·åˆ¶åœæ­¢
kill -9 $(cat backend.pid) $(cat frontend.pid)
```

## å¾“æ¥ã®èµ·å‹•æ–¹æ³•ã¨ã®é•ã„

| æ©Ÿèƒ½ | `pnpm run dev` | `pnpm run dev:stable` |
|------|----------------|----------------------|
| å®Ÿè¡Œæ–¹å¼ | ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ | ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ |
| Ctrl+C ã®å½±éŸ¿ | åœæ­¢ã™ã‚‹ | å½±éŸ¿ãªã— |
| ãƒ­ã‚°å‡ºåŠ› | ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è¡¨ç¤º | ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ |
| ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç† | é›£ã—ã„ | PIDãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç† |
| ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‰ã˜ã‚‹ | åœæ­¢ã™ã‚‹ | ç¶™ç¶šã™ã‚‹ |
| é©ç”¨å ´é¢ | çŸ­æ™‚é–“ã®é–‹ç™º | é•·æ™‚é–“ã®é–‹ç™º |

## æ³¨æ„äº‹é …

1. **PIDãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†**: `backend.pid` ã¨ `frontend.pid` ãƒ•ã‚¡ã‚¤ãƒ«ã¯è‡ªå‹•çš„ã«ä½œæˆãƒ»å‰Šé™¤ã•ã‚Œã¾ã™ãŒã€ç•°å¸¸çµ‚äº†ã—ãŸå ´åˆã¯æ‰‹å‹•ã§å‰Šé™¤ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚

2. **ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚µã‚¤ã‚º**: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¯è‡ªå‹•çš„ã«ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã¾ã›ã‚“ã€‚å®šæœŸçš„ã«ç¢ºèªãƒ»å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚

3. **ãƒãƒ¼ãƒˆã®ç«¶åˆ**: æ—¢ã« 3004 ã¾ãŸã¯ 3000 ãƒãƒ¼ãƒˆãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€`pnpm run predev` ã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

- `scripts/start-dev-stable.sh` - å®‰å®šç‰ˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `scripts/stop-dev.sh` - ã‚µãƒ¼ãƒãƒ¼åœæ­¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `scripts/health-check.sh` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

ã™ã¹ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å®Ÿè¡Œæ¨©é™ãŒä»˜ä¸ã•ã‚Œã¦ã„ã¾ã™ï¼ˆ`chmod +x` æ¸ˆã¿ï¼‰ã€‚

## ã¾ã¨ã‚

å®‰å®šç‰ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’ç¢ºå®Ÿã«èµ·å‹•ã—ã€é•·æ™‚é–“ç¨¼åƒã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å¾“æ¥ã® `pnpm run dev` ã§Ctrl+Cã«ã‚ˆã‚‹äºˆæœŸã—ãªã„åœæ­¢ãŒç™ºç”Ÿã—ã¦ã„ãŸå•é¡ŒãŒè§£æ±ºã•ã‚Œã¾ã—ãŸã€‚
